name: Setup Trivy Repeat Installs (Different Versions)

on:
  push:
    branches:
      - "*"
    tags:
      - "*"
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  test:
    strategy:
      matrix:
        version: [ 'latest', 'v0.56.2', 'v0.55.1']
        caching: [ true, false ]
      fail-fast: false
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Check out Git repository
        uses: actions/checkout@v4

      ## NB - Each call to setup-trivy will install trivy each time unless caching is enabled

      - name: Setup Trivy
        uses: rvesse/setup-trivy@avoid-repeat-install
        with:
          version: ${{ matrix.version }}
          cache: ${{ matrix.caching }}

      - name: Setup Trivy Again (Different Version)
        uses: rvesse/setup-trivy@avoid-repeat-install
        with:
          version: v0.55.0
          cache: ${{ matrix.caching }}
          path: /tmp

      - name: Show PATH
        run: |
          echo $PATH

      - name: Show default trivy version
        run: |
          trivy --version

      - name: Show first installed trivy version
        run: |
          $HOME/.local/bin/trivy-bin/trivy --version

      - name: Show additional trivy version
        run: |
          /tmp/trivy-bin/trivy --version